<!DOCTYPE html>
<html>
<head>
    <title>Early Warning Web Application</title>
    <link rel="icon"
          href="images/favicon.ico">
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <!-- Custom styles -->
    <link rel="stylesheet" href="css/style.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@2.3.2/dist/email.min.js"></script>
    <script type="text/javascript">
        (function(){
            emailjs.init("user_WKrExGaYN0bX2adliw5ah");
        })();
    </script>
    <script type="text/javascript">
        function GetFileSizeNameAndType()
        {
            var fi = document.getElementById('file'); // GET THE FILE INPUT AS VARIABLE.

            var totalFileSize = 0;

            // VALIDATE OR CHECK IF ANY FILE IS SELECTED.
            if (fi.files.length > 0)
            {
                // RUN A LOOP TO CHECK EACH SELECTED FILE.
                for (var i = 0; i <= fi.files.length - 1; i++)
                {
                    //ACCESS THE SIZE PROPERTY OF THE ITEM OBJECT IN FILES COLLECTION. IN THIS WAY ALSO GET OTHER PROPERTIES LIKE FILENAME AND FILETYPE
                    document.getElementById('fp').innerHTML =
                        document.getElementById('fp').innerHTML + '<br /> ' + '<b>' + fi.files.item(i).name + "</b>.";
                }
            }
        };

        if (typeof (Storage) !== "undefined") {
            //alert("Code for localStorage/sessionStorage.");
        } else {
            alert("Sorry! No Web Storage support.");
        }
        if (!!localStorage.fcraNo) {
            //localStorage.fcraNo = 0;
        }
        else {
            localStorage.fcraNo = 0;
        }
        function OnSubmit()
        {
            var subject = document.getElementById('fcraSubject').value;
            var content = document.getElementById('fcraContent').value;
            //var sender = document.getElementById('sender').value;

            localStorage.fcraNo++;
            var fcra_num = "000000000" + localStorage.fcraNo;
            fcra_num = fcra_num.substr(fcra_num.length-6);

            //var templateParams = {
            //    fcra_no: fcra_num,
            //    subject: subject,
            //    content: content,
            //    from_name: sender,
            //    to_name: 'FCRA Team',
            //    message_html: "<h1>My First Heading</h1>\n" +
            //        "<p>My first paragraph.</p>"
            //};

            var mailUrl = "mailto:ming@dmartin.org?subject=[EXTERNAL] FCRA#"+fcra_num+' '+subject+"&body="+content;
            //alert(mailUrl);
            window.open(mailUrl);

            //emailjs.send('gmail', 'template_fYc4JTyi', templateParams) //use your Service ID and Template ID
            //    .then(function(response) {
            //        alert("SUCCESS!");
            //        console.log('SUCCESS!', response.status, response.text);
            //    }, function(error) {
            //        alert("FAILED!");
            //        console.log('FAILED...', error);
            //    });

            alert("DONE");
        }
    </script>
</head>
<body>
    <div class="container">
        <div class="header clearfix">
            <h3 class="text-muted"><a href="index.html"><img src="images/EW-favicon.png" /></a>   FCRA Document Processing</h3>
        </div>
        <div class="row marketing">
            <form id="fcraForm">
                <h3 class="form-signin-heading">Enter FCRA Ticket</h3>
                <label for="fcraSubject"><b>Subject:</b></label>
                <br>
                <input type="text" id="fcraSubject" size="200" class="form-control" placeholder="Subject" required="" autofocus="">
                <label for="fcraContent"><b>Content:</b></label>
                <br>
                <textarea id="fcraContent" rows="6" class="form-control" required=""></textarea>
<!--                <label for="file"><b>Attachment:</b></label>
                <br>
                <input type="file" id="file" multiple onchange="GetFileSizeNameAndType()" />
                    <div id="fp"></div>
                !-->
                <br>
                <button class="btn btn-lg btn-primary btn-block" style="background:#262626" onclick="OnSubmit()">Submit</button>
                <br>
            </form>
        </div>
        <footer class="footer">
            <p>2020 Early Warning</p>
        </footer>
    </div>
</body>
</html>
